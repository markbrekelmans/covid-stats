<!doctype html>
<html lang="nl">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Informatie over de trend van COVID-19 in Nederland">
    <meta name="author" content="Mark Brekelmans">

    <title>COVID-19 trend in Nederland</title>

    <meta property="og:title" content="">
    <meta property="og:type" content="">
    <meta property="og:url" content="">
    <meta property="og:image" content="">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <style>
    body{padding-top:5rem}a,a:visited,a:hover{color:#3740ff}.figure{width:100%}.figure-img{height:600px}.starter-template{padding:3rem 1.5rem;text-align:left}
    </style>
  </head>

  <body>
    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
      <a class="navbar-brand" href="#"><span class="brand-text">[option+H]</span></a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarsExampleDefault">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="#">COVID-19 in NL <span class="sr-only">(huidig)</span></a>
          </li>
        </ul>
        <form class="form-inline my-2 my-lg-0">
          <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
          <button class="btn btn-secondary my-2 my-sm-0" type="submit">Search</button>
        </form>
      </div>
    </nav><!-- /navbar -->
    <main role="main" class="container">
      <div class="starter-template">
        <div class="row">
          <div class="col">
            <h1>COVID-19 trend in Nederland</h1>
            <p class="lead">Op deze pagina staan grafieken die de trend van het aantal COVID-19 gevallen in Nederland weergeven. De data hiervoor is afkomstig van <a href="https://data.rivm.nl/covid-19/" target="_blank" rel="noreferrer" title="data.rivm.nl">data.rivm.nl</a>.</p>
          </div><!-- /col -->
        </div><!-- /row -->
        <div class="row">
          <div class="col">
            <figure class="figure">
              <div class="figure-img img-fluid rounded" id="viz-1">
                <div class="d-flex justify-content-center">
                  <div class="spinner-border" role="status">
                    <span class="sr-only">Loading...</span>
                  </div>
                </div>
              </div>
            </figure>
          </div><!-- /col -->
        </div><!-- /row -->
        <div class="row">
          <div class="col">
            <figure class="figure">
              <div class="figure-img img-fluid rounded" id="viz-2">
                <div class="d-flex justify-content-center">
                  <div class="spinner-border" role="status">
                    <span class="sr-only">Loading...</span>
                  </div>
                </div>
              </div>
            </figure>
          </div><!-- /col -->
        </div><!-- /row -->
        <div class="row">
          <div class="col">
            <figure class="figure">
              <div class="figure-img img-fluid rounded" id="viz-3">
                <div class="d-flex justify-content-center">
                  <div class="spinner-border" role="status">
                    <span class="sr-only">Loading...</span>
                  </div>
                </div>
              </div>
            </figure>
          </div><!-- /col -->
        </div><!-- /row -->
        <div class="row">
          <div class="col">
            <figure class="figure">
              <div class="figure-img img-fluid rounded" id="viz-4">
                <div class="d-flex justify-content-center">
                  <div class="spinner-border" role="status">
                    <span class="sr-only">Loading...</span>
                  </div>
                </div>
              </div>
            </figure>
          </div><!-- /col -->
        </div><!-- /row -->
      </div><!-- /starter-template -->
    </main><!-- /container -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script type="text/javascript" src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="/assets/js/plugins.js"></script>
    <script type="text/javascript">
    google.charts.load('current', {'packages': ['table', 'corechart']});
    google.charts.setOnLoadCallback(initiate);

    var options_viz_1 = {title:'Dagelijkse gevallen',titleTextStyle:{fontSize:16},series:{0:{color:'#E63946'}},hAxis:{title:'Rapportage datum',titleTextStyle:{fontSize:12}},vAxis:{format:'short',titleTextStyle:{fontSize:12}},legend:{position:'none'}}
    var options_viz_2 = {title:'Cumulatieve gevallen',titleTextStyle:{fontSize:16},series:{0:{color:'#E63946'}},hAxis:{title:'Rapportage datum',titleTextStyle:{fontSize:12}},vAxis:{format:'short',titleTextStyle:{fontSize:12}},legend:{position:'none'}}
    var options_viz_3 = {title:'Cumulatieve vs. 7-daagse gevallen',titleTextStyle:{fontSize:16},hAxis:{title:'Cumulatieve gevallen',logScale:!0,minValue:0,maxValue:100000,format:'short',titleTextStyle:{fontSize:12}},vAxis:{title:'7-daagse gevallen',logScale:!0,minValue:0,maxValue:100000,format:'short',titleTextStyle:{fontSize:12}},legend:{position:'none'},series:{0:{color:'#E63946'}}}
    var options_viz_4 = {page:'enable',pageSize:20,sortColumn:0,sortAscending:0,width:'100%'}

    function initiate() {
      $.get('https://data.rivm.nl/covid-19/COVID-19_aantallen_gemeente_cumulatief.csv', function(csvData) {
        var arrData = $.csv.toArrays(csvData, {'separator': ';', onParseValue: $.csv.hooks.castToScalar});

        var main_table = new google.visualization.DataTable();
        main_table.addColumn('date', 'Date');
        main_table.addColumn('number', 'Cumulatieve gevallen');
        main_table.addRows([[new Date('2020-03-01'),0],[new Date('2020-03-02'),0],[new Date('2020-03-03'),0],[new Date('2020-03-04'),0],[new Date('2020-03-05'),82],[new Date('2020-03-06'),128],[new Date('2020-03-07'),188],[new Date('2020-03-08'),265],[new Date('2020-03-09'),321],[new Date('2020-03-10'),382],[new Date('2020-03-11'),503],[new Date('2020-03-12'),503]])

        for(var r=1; r<arrData.length; r++) {
          main_table.addRow([
            new Date(arrData[r][0].substring(0,10)),
            arrData[r][4]
          ])
        }

        var main_table = google.visualization.data.group(main_table,[0],[{'column':1,'aggregation':google.visualization.data.sum,'type':'number'}]);

        function movingAverage(main_table,rowNum){return (rowNum<7) ? Math.floor(main_table.getValue(rowNum, 1) - main_table.getValue(0, 1)) : Math.floor(main_table.getValue(rowNum, 1) - main_table.getValue(Math.max(0,rowNum-7), 1))}
        function deltaPrev(main_table,rowNum){return Math.max(0,Math.floor(main_table.getValue(rowNum, 1) - main_table.getValue(Math.max(0,rowNum-1),1)))}

        var base_view = new google.visualization.DataView(main_table);
        base_view.setColumns([0,{calc:deltaPrev,type:'number',label:'Dagelijkse gevallen'}]);

        var exp_view = new google.visualization.DataView(main_table);
        exp_view.setColumns([1,{calc:movingAverage,type:'number',label:'7-daagse gevallen'}]);

        var table_view = new google.visualization.DataView(main_table);
        table_view.setColumns([0,1,{calc:deltaPrev,type:'number',label:'Dagelijkse gevallen'},{calc:movingAverage,type:'number',label:'7-daagse gevallen'}]);

        var viz_base = new google.visualization.AreaChart(document.getElementById('viz-1'));
        viz_base.draw(base_view, options_viz_1);

        var viz_total = new google.visualization.AreaChart(document.getElementById('viz-2'));
        viz_total.draw(main_table, options_viz_2);

        var viz_exp = new google.visualization.LineChart(document.getElementById('viz-3'));
        viz_exp.draw(exp_view, options_viz_3);

        var viz_table = new google.visualization.Table(document.getElementById('viz-4'));
        viz_table.draw(table_view, options_viz_4);
      });
    }
    window.onresize=function(event){initiate();}
    </script>
  </body>
</html>
